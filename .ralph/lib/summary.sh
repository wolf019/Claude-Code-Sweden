#!/bin/bash
# summary.sh - Generate summary report
# Source this file: source lib/summary.sh

LOG_DIR="${LOG_DIR:-ralph-logs}"
RATE_LIMIT_LOG="${RATE_LIMIT_LOG:-$HOME/ralph-rate-limits.log}"
TOKEN_LOG="${TOKEN_LOG:-$HOME/ralph-tokens.log}"

# Generate markdown summary
generate_summary() {
    local specs_done="$1"
    local specs_failed="$2"
    local specs_total="$3"
    local timestamp=$(date +%Y%m%d_%H%M%S)

    mkdir -p "$LOG_DIR"
    local file="$LOG_DIR/ralph-summary-$timestamp.md"

    cat > "$file" << EOF
# ðŸ¤– Ralph Summary

**Time:** $(date '+%Y-%m-%d %H:%M:%S')

## Results

| Status | Count |
|--------|-------|
| âœ… Done | $specs_done |
| âŒ Failed | $specs_failed |
| **Total** | $specs_total |

## Rate Limits

$(tail -5 "$RATE_LIMIT_LOG" 2>/dev/null || echo "None")

## Token Usage

$(tail -5 "$TOKEN_LOG" 2>/dev/null || echo "No data")

## Cost Estimate

$(print_cost_summary 2>/dev/null || echo "No cost data")

---
*Generated by Ralph*
EOF

    echo "[summary] $file"
}
